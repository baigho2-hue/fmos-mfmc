# Generated by Django 4.2.26 on 2025-11-30 13:22

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('utilisateurs', '0043_comptebancaire_paiementformation_compte_bancaire'),
        ('evaluations', '0006_update_echelle_evaluation'),
    ]

    operations = [
        migrations.CreateModel(
            name='EvaluationStage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom_superviseur', models.CharField(blank=True, help_text="Si différent de l'enseignant connecté", max_length=200, null=True, verbose_name='Nom du superviseur')),
                ('type_evaluation', models.CharField(choices=[('formative', 'Évaluation Formative'), ('sommative', 'Évaluation Sommative'), ('intermediaire', 'Évaluation Intermédiaire'), ('finale', 'Évaluation Finale de Stage')], default='formative', max_length=20, verbose_name="Type d'évaluation")),
                ('date_evaluation', models.DateField(default=django.utils.timezone.now, verbose_name="Date de l'évaluation")),
                ('statut', models.CharField(choices=[('brouillon', 'Brouillon'), ('soumis', 'Soumis pour vérification'), ('verifie', 'Vérifié par la coordination'), ('disponible', "Disponible pour l'étudiant"), ('rejete', 'Rejeté')], default='brouillon', max_length=20, verbose_name='Statut')),
                ('commentaire_general', models.TextField(blank=True, help_text="Commentaire général sur l'évaluation du stage", null=True, verbose_name='Commentaire général')),
                ('signature_responsable', models.ImageField(blank=True, help_text='Image de la signature du responsable', null=True, upload_to='evaluations/signatures/', verbose_name='Signature du responsable de stage')),
                ('cachet_structure', models.ImageField(blank=True, help_text='Image du cachet de la structure de stage', null=True, upload_to='evaluations/cachets/', verbose_name='Cachet de la structure')),
                ('date_verification', models.DateTimeField(blank=True, null=True, verbose_name='Date de vérification')),
                ('commentaire_verification', models.TextField(blank=True, null=True, verbose_name='Commentaire de vérification')),
                ('date_creation', models.DateTimeField(auto_now_add=True, verbose_name='Date de création')),
                ('date_modification', models.DateTimeField(auto_now=True, verbose_name='Date de modification')),
                ('classe', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_stage', to='utilisateurs.classe', verbose_name='Classe')),
                ('enseignant', models.ForeignKey(limit_choices_to={'type_utilisateur': 'enseignant'}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluations_stage_enseignant', to=settings.AUTH_USER_MODEL, verbose_name='Enseignant / Superviseur')),
                ('etudiant', models.ForeignKey(limit_choices_to={'type_utilisateur': 'etudiant'}, on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_stage', to=settings.AUTH_USER_MODEL, verbose_name='Étudiant')),
                ('stage_rotation', models.ForeignKey(blank=True, help_text="Stage de rotation DES si l'évaluation concerne un stage DES", null=True, on_delete=django.db.models.deletion.CASCADE, related_name='evaluations', to='utilisateurs.stagerotationdes', verbose_name='Stage DES (si applicable)')),
                ('structure_stage', models.ForeignKey(blank=True, help_text='CSCom-U ou autre structure où se déroule le stage', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluations_stage', to='utilisateurs.cscomucentre', verbose_name='Structure de stage')),
                ('verifie_par', models.ForeignKey(blank=True, help_text="Membre de la coordination qui a vérifié l'évaluation", null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='evaluations_stage_verifiees', to=settings.AUTH_USER_MODEL, verbose_name='Vérifié par')),
            ],
            options={
                'verbose_name': 'Évaluation de stage',
                'verbose_name_plural': 'Évaluations de stage',
                'ordering': ['-date_evaluation', 'etudiant'],
            },
        ),
        migrations.CreateModel(
            name='EvaluationJalonStage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('niveau', models.CharField(blank=True, choices=[('1', '1 : Insuffisante'), ('2', '2 : Inconstante/Inférieure aux attentes'), ('3', '3 : Conforme aux attentes'), ('4', '4 : Dépasse nettement les attentes'), ('5', '5 : NA (Non Applicable)')], max_length=1, null=True, verbose_name='Niveau atteint')),
                ('commentaire', models.TextField(blank=True, help_text='Commentaire spécifique pour cette compétence/jalon', null=True, verbose_name='Commentaire')),
                ('ordre', models.IntegerField(default=0, verbose_name="Ordre d'affichage")),
                ('evaluation_stage', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_jalons', to='evaluations.evaluationstage', verbose_name='Évaluation de stage')),
                ('jalon', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluations_stage', to='utilisateurs.competencejalon', verbose_name='Jalon de compétence')),
            ],
            options={
                'verbose_name': 'Évaluation jalon de stage',
                'verbose_name_plural': 'Évaluations jalons de stage',
                'ordering': ['evaluation_stage', 'ordre', 'jalon__competence__libelle', 'jalon__ordre'],
            },
        ),
        migrations.AddIndex(
            model_name='evaluationstage',
            index=models.Index(fields=['etudiant', 'classe', 'date_evaluation'], name='evaluations_etudian_356675_idx'),
        ),
        migrations.AddIndex(
            model_name='evaluationstage',
            index=models.Index(fields=['statut', 'date_evaluation'], name='evaluations_statut_9a756d_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='evaluationjalonstage',
            unique_together={('evaluation_stage', 'jalon')},
        ),
    ]
