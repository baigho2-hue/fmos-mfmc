{% extends "base.html" %}
{% load static %}

{% block title %}√âvaluations de Stages - Coordination{% endblock %}

{% block content %}
<div class="administration-container">
    <div class="page-header">
        <div class="header-top">
            <div>
                <h1>üìä √âvaluations de Stages</h1>
                <p class="subtitle">Vue d'ensemble de toutes les √©valuations de stage</p>
            </div>
        </div>
    </div>

    <!-- Statistiques -->
    <div class="stats-section">
        <div class="stat-card">
            <div class="stat-number">{{ total_evaluations }}</div>
            <div class="stat-label">Total √©valuations</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ evaluations_completes }}</div>
            <div class="stat-label">√âvaluations compl√®tes</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ evaluations_validees }}</div>
            <div class="stat-label">√âvaluations valid√©es</div>
        </div>
    </div>

    <!-- Filtre par classe -->
    <div class="filter-section">
        <form method="get" action="{% url 'evaluations_stages_coordination' %}" class="filter-form">
            <label for="classe">Filtrer par classe :</label>
            <select name="classe" id="classe" class="form-control" onchange="this.form.submit()">
                <option value="">Toutes les classes</option>
                {% for classe in classes_desmfmc %}
                <option value="{{ classe.id }}" {% if classe_selected and classe_selected.id == classe.id %}selected{% endif %}>
                    {{ classe.nom }} ({{ classe.formation.nom }})
                </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- Liste des √©valuations -->
    {% if evaluations %}
    <div class="evaluations-list">
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>√âtudiant</th>
                        <th>Ann√©e</th>
                        <th>Type de stage</th>
                        <th>Lieu</th>
                        <th>P√©riode</th>
                        <th>Note</th>
                        <th>Superviseur</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for evaluation in evaluations %}
                    <tr>
                        <td>
                            <strong>{{ evaluation.carnet.etudiant.get_full_name|default:evaluation.carnet.etudiant.username }}</strong><br>
                            <small>{{ evaluation.carnet.etudiant.email }}</small>
                        </td>
                        <td>{{ evaluation.annee }}√®me ann√©e</td>
                        <td>{{ evaluation.get_type_stage_display }}</td>
                        <td>{{ evaluation.lieu_stage }}</td>
                        <td>
                            {{ evaluation.date_debut|date:"d/m/Y" }}<br>
                            <small>au {{ evaluation.date_fin|date:"d/m/Y" }}</small>
                        </td>
                        <td>
                            {% if evaluation.note_globale %}
                                <strong>{{ evaluation.note_globale }}/20</strong>
                            {% else %}
                                <span class="badge badge-warning">Non not√©</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if evaluation.evalue_par_superviseur %}
                                {{ evaluation.evalue_par_superviseur.get_full_name }}<br>
                                <small>{{ evaluation.date_evaluation_superviseur|date:"d/m/Y H:i" }}</small>
                            {% else %}
                                <span class="badge badge-danger">Non rempli</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if evaluation.valide %}
                                <span class="badge badge-success">‚úì Valid√©</span>
                            {% elif evaluation.evalue_par_superviseur %}
                                <span class="badge badge-info">En attente validation</span>
                            {% else %}
                                <span class="badge badge-warning">En cours</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'detail_evaluation_stage' evaluation.id %}" class="btn-primary btn-sm">Voir d√©tails</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if evaluations.has_other_pages %}
        <div class="pagination">
            {% if evaluations.has_previous %}
            <a href="?page={{ evaluations.previous_page_number }}{% if classe_selected %}&classe={{ classe_selected.id }}{% endif %}" class="btn-pagination">‚Üê Pr√©c√©dent</a>
            {% endif %}
            
            <span class="page-info">
                Page {{ evaluations.number }} sur {{ evaluations.paginator.num_pages }}
            </span>
            
            {% if evaluations.has_next %}
            <a href="?page={{ evaluations.next_page_number }}{% if classe_selected %}&classe={{ classe_selected.id }}{% endif %}" class="btn-pagination">Suivant ‚Üí</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="no-data">
        <p>{% if classe_selected %}Aucune √©valuation trouv√©e pour la classe {{ classe_selected.nom }}.{% else %}S√©lectionnez une classe pour voir les √©valuations.{% endif %}</p>
    </div>
    {% endif %}
</div>

{% block extra_css %}
<style>
.stats-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #005a9c;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #666;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
</style>
{% endblock %}
{% endblock %}

