{% extends "base.html" %}
{% load static %}

{% block title %}Modifier le cours - FMOS MFMC{% endblock %}

{% block content %}
<div class="form-container">
    <div class="page-header">
        <h1>Modifier le cours</h1>
        <p class="subtitle">{{ cours.titre }}</p>
    </div>

    <form method="POST" class="cours-form" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="modifier_cours">
        
        <div class="form-group">
            <label for="titre">Titre du cours *</label>
            <input type="text" name="titre" id="titre" class="form-control" value="{{ cours.titre }}" required>
        </div>
        
        <div class="form-group">
            <label for="description">Description *</label>
            <textarea name="description" id="description" class="form-control" rows="4" required>{{ cours.description }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="contenu">Contenu d√©taill√© *</label>
            <textarea name="contenu" id="contenu" class="form-control" rows="10" required>{{ cours.contenu }}</textarea>
            <small class="form-help">Vous pouvez utiliser du HTML ou du Markdown pour formater le contenu</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-submit">üíæ Enregistrer les modifications</button>
            <a href="{% url 'mes_cours_enseignant' %}" class="btn-cancel">Annuler</a>
        </div>
    </form>

    <!-- Section Gestion des Le√ßons -->
    <div class="lecons-section">
        <div class="section-header">
            <h2>üìö Le√ßons du cours</h2>
            <button type="button" class="btn-add-lecon" onclick="toggleAddLeconForm()">‚ûï Ajouter une le√ßon</button>
        </div>

        <!-- Formulaire d'ajout de le√ßon (masqu√© par d√©faut) -->
        <div id="add-lecon-form" class="lecon-form-container" style="display: none;">
            <h3>Ajouter une nouvelle le√ßon</h3>
            <form method="POST" action="{% url 'ajouter_lecon' cours.id %}" enctype="multipart/form-data" class="lecon-form">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group">
                        <label for="lecon_titre">Titre de la le√ßon *</label>
                        <input type="text" name="titre" id="lecon_titre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="lecon_numero">Num√©ro *</label>
                        <input type="number" name="numero" id="lecon_numero" class="form-control" min="1" value="{{ lecons|length|add:1 }}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lecon_type">Type de le√ßon</label>
                        <select name="type_lecon" id="lecon_type" class="form-control">
                            <option value="lecon">Le√ßon</option>
                            <option value="atelier">Atelier</option>
                            <option value="tp">Travaux pratiques</option>
                            <option value="td">Travaux dirig√©s</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lecon_ordre">Ordre d'affichage</label>
                        <input type="number" name="ordre" id="lecon_ordre" class="form-control" min="0" value="{{ lecons|length }}">
                    </div>
                </div>
                <div class="form-group">
                    <label for="lecon_fichier">Fichier de la le√ßon *</label>
                    <input type="file" name="fichier_contenu" id="lecon_fichier" class="form-control" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip" required>
                    <small class="form-help">Formats accept√©s: PDF, Word, PowerPoint, TXT, ZIP</small>
                </div>
                <div class="form-group">
                    <label for="lecon_description">Description</label>
                    <textarea name="contenu" id="lecon_description" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lecon_duree">Dur√©e estim√©e (minutes)</label>
                        <input type="number" name="duree_estimee" id="lecon_duree" class="form-control" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="lecon_date">Date de dispensation</label>
                        <input type="datetime-local" name="date_dispensation" id="lecon_date" class="form-control">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-submit">‚úÖ Ajouter la le√ßon</button>
                    <button type="button" class="btn-cancel" onclick="toggleAddLeconForm()">Annuler</button>
                </div>
            </form>
        </div>

        <!-- Liste des le√ßons existantes -->
        <div class="lecons-list">
            {% if lecons %}
                {% for lecon in lecons %}
                <div class="lecon-item" id="lecon-{{ lecon.id }}">
                    <div class="lecon-header">
                        <div class="lecon-info">
                            <h4>
                                <span class="lecon-numero">Le√ßon {{ lecon.numero }}</span>
                                <span class="lecon-titre">{{ lecon.titre }}</span>
                                <span class="lecon-type badge">{{ lecon.get_type_lecon_display }}</span>
                            </h4>
                            {% if lecon.fichier_contenu %}
                                <a href="{{ lecon.fichier_contenu.url }}" target="_blank" class="lecon-file-link">üìÑ Voir le fichier</a>
                            {% else %}
                                <span class="lecon-no-file">‚ö†Ô∏è Aucun fichier</span>
                            {% endif %}
                        </div>
                        <div class="lecon-actions">
                            <button type="button" class="btn-edit" onclick="toggleEditLeconForm({{ lecon.id }})">‚úèÔ∏è Modifier</button>
                            <form method="POST" action="{% url 'supprimer_lecon' cours.id lecon.id %}" style="display: inline;" onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette le√ßon ?');">
                                {% csrf_token %}
                                <button type="submit" class="btn-delete">üóëÔ∏è Supprimer</button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Formulaire de modification (masqu√© par d√©faut) -->
                    <div id="edit-lecon-form-{{ lecon.id }}" class="lecon-form-container" style="display: none;">
                        <h4>Modifier la le√ßon</h4>
                        <form method="POST" action="{% url 'modifier_lecon' cours.id lecon.id %}" enctype="multipart/form-data" class="lecon-form">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Titre de la le√ßon *</label>
                                    <input type="text" name="titre" class="form-control" value="{{ lecon.titre }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Num√©ro *</label>
                                    <input type="number" name="numero" class="form-control" min="1" value="{{ lecon.numero }}" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type de le√ßon</label>
                                    <select name="type_lecon" class="form-control">
                                        <option value="lecon" {% if lecon.type_lecon == 'lecon' %}selected{% endif %}>Le√ßon</option>
                                        <option value="atelier" {% if lecon.type_lecon == 'atelier' %}selected{% endif %}>Atelier</option>
                                        <option value="tp" {% if lecon.type_lecon == 'tp' %}selected{% endif %}>Travaux pratiques</option>
                                        <option value="td" {% if lecon.type_lecon == 'td' %}selected{% endif %}>Travaux dirig√©s</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ordre d'affichage</label>
                                    <input type="number" name="ordre" class="form-control" min="0" value="{{ lecon.ordre }}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Fichier de la le√ßon (laisser vide pour ne pas modifier)</label>
                                <input type="file" name="fichier_contenu" class="form-control" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip">
                                {% if lecon.fichier_contenu %}
                                    <small class="form-help">Fichier actuel: <a href="{{ lecon.fichier_contenu.url }}" target="_blank">{{ lecon.fichier_contenu.name|slice:"30:" }}</a></small>
                                {% endif %}
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="contenu" class="form-control" rows="3">{{ lecon.contenu }}</textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Dur√©e estim√©e (minutes)</label>
                                    <input type="number" name="duree_estimee" class="form-control" min="0" value="{{ lecon.duree_estimee }}">
                                </div>
                                <div class="form-group">
                                    <label>Date de dispensation</label>
                                    <input type="datetime-local" name="date_dispensation" class="form-control" value="{% if lecon.date_dispensation %}{{ lecon.date_dispensation|date:'Y-m-d\TH:i' }}{% endif %}">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-submit">üíæ Enregistrer</button>
                                <button type="button" class="btn-cancel" onclick="toggleEditLeconForm({{ lecon.id }})">Annuler</button>
                            </div>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-lecons">
                    <p>üìù Aucune le√ßon n'a encore √©t√© ajout√©e √† ce cours.</p>
                    <p>Cliquez sur "Ajouter une le√ßon" pour commencer.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.form-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}

.page-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #005a9c;
}

.page-header h1 {
    color: #005a9c;
    margin-bottom: 0.5rem;
}

.subtitle {
    color: #666;
    font-size: 1.1rem;
}

.cours-form {
    background: #ffffff;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #333;
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1rem;
    box-sizing: border-box;
    font-family: inherit;
}

.form-control:focus {
    outline: none;
    border-color: #005a9c;
    box-shadow: 0 0 0 2px rgba(0, 90, 156, 0.1);
}

textarea.form-control {
    resize: vertical;
    min-height: 100px;
}

.form-help {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #666;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.btn-submit {
    flex: 1;
    padding: 1rem;
    background-color: #005a9c;
    color: #ffffff;
    border: none;
    border-radius: 5px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-submit:hover {
    background-color: #004070;
}

.btn-cancel {
    padding: 1rem 2rem;
    background-color: #6c757d;
    color: #ffffff;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

.btn-cancel:hover {
    background-color: #5a6268;
}

/* Section Le√ßons */
.lecons-section {
    margin-top: 3rem;
    background: #ffffff;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #005a9c;
}

.section-header h2 {
    color: #005a9c;
    margin: 0;
}

.btn-add-lecon {
    padding: 0.75rem 1.5rem;
    background-color: #28a745;
    color: #ffffff;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-add-lecon:hover {
    background-color: #218838;
}

.lecon-form-container {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 5px;
    margin-bottom: 1.5rem;
    border: 1px solid #dee2e6;
}

.lecon-form-container h3,
.lecon-form-container h4 {
    color: #005a9c;
    margin-top: 0;
    margin-bottom: 1rem;
}

.lecon-form {
    margin-top: 1rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.lecons-list {
    margin-top: 1.5rem;
}

.lecon-item {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: box-shadow 0.2s ease;
}

.lecon-item:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.lecon-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.lecon-info h4 {
    margin: 0 0 0.5rem 0;
    color: #333;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.lecon-numero {
    font-weight: bold;
    color: #005a9c;
}

.lecon-titre {
    color: #333;
}

.lecon-type.badge {
    background: #6c757d;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: normal;
}

.lecon-file-link {
    color: #005a9c;
    text-decoration: none;
    font-size: 0.9rem;
    display: inline-block;
    margin-top: 0.5rem;
}

.lecon-file-link:hover {
    text-decoration: underline;
}

.lecon-no-file {
    color: #dc3545;
    font-size: 0.9rem;
    display: inline-block;
    margin-top: 0.5rem;
}

.lecon-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-edit,
.btn-delete {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 5px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-edit {
    background-color: #ffc107;
    color: #000;
}

.btn-edit:hover {
    background-color: #e0a800;
}

.btn-delete {
    background-color: #dc3545;
    color: #ffffff;
}

.btn-delete:hover {
    background-color: #c82333;
}

.no-lecons {
    text-align: center;
    padding: 2rem;
    color: #6c757d;
}

.no-lecons p {
    margin: 0.5rem 0;
}

@media screen and (max-width: 768px) {
    .form-container {
        padding: 1rem;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .btn-add-lecon {
        width: 100%;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .lecon-header {
        flex-direction: column;
        gap: 1rem;
    }
    
    .lecon-actions {
        width: 100%;
        justify-content: stretch;
    }
    
    .btn-edit,
    .btn-delete {
        flex: 1;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function toggleAddLeconForm() {
    const form = document.getElementById('add-lecon-form');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

function toggleEditLeconForm(leconId) {
    const form = document.getElementById('edit-lecon-form-' + leconId);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}
</script>
{% endblock %}

